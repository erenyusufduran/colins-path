# Multi Org Setup with Root Certification Authority

Beginning of this initiative, it was decided that the network will be setup with the Orderer Organization and Acme Organization and then in phase two, we add the Budget Organization.

We have tried the network setup with the best crypto material generated by cryptogen tool. Going forward, we're going to add the CA server in this mix. So the identities for all the components in the network will be managed in the CA server.

- In test setup, there is `ca/multi-org-ca` in this folder there is a subfolders like `client` and `server`.
- `orderer/mult-org-ca`
- `peer/multi-org-ca`

## Fabric CA Server, Roles & Identities

There will be three roles in the multi org setup that we are going to create.

- **CA Server Admin**
  - Bootstrap identity created on the CA Server.
  - The Root CA server admin may be considerer as a super user from identity management perspective. They can manage any identity across all organizations.
- **Organization Admin**
  - There will three organization admins. These three elements will created by the RootCA server admin.
    - `acme-admin`
    - `budget-admin`
    - `orderer-admin`
  - The organization admin can carry out identitiy management actions against the other entities within their respective organization.
- Then each of these organization admins will create **Organization Identities**.
  - They will be human actors and they will be the **Peers**, **Ordering Service** and **Client (Application)** identities.
  - For the Organization Identity, the type and authority is set by the organization admin.

### CA Home Folders

- `ca`
  - `multi-org-ca` - **Root Folder:** All of the server and client related data folders for the fabrics here.
    - `server` - **Server Root Folder:** Root for the CA server.
      - `fabric-ca-server-config` managed in this folder.
        - We'll use `config/multi-org-ca/yaml.0`
        - `csr`
        - `affiliations` section include departments and organizations.
    - `client` - **Client Identities:** To manage the crypto for all of the identities.
      - `ca-server` - Home folder for the bootstrap identity (admin)
        - Admin will need to set the path to the admin folder in the environment variable `FABRIC_CA_CLIENT_HOME`
      - `acme`
      - `budget`
      - `orderer`

## CA Server Setup

1. Setup Root CA Server - `./server.sh start`
   - Set up the FABRIC_CA_SERVER_HOME variable.
     - export `FABRIC_CA_SERVER_HOME=ca/multi-org-ca/server`
   - Copy the `fabric-ca-server-config` from following to `./server`
     - `setup/config/multi-org-ca/yaml.0/fabric-ca-server-config.yaml`
   - Execute `fabric-ca-server start` command.
2. Enroll Admin Identity - `./server.sh enroll`
   - Set up the FABRIC_CA_CLIENT_HOME variable.
     - export `FABRIC_CA_CLIENT_HOME=ca/multi-org-ca/client/caserver/admin`
   - Copy yo `$FABRIC_CA_CLIENT_HOME` from yaml.0
   - Execute _enroll_ commmand for admin

## Register & Enroll Organization Identities

Setup for each admin is different. Org Identities created by the Org Admins.

- Enrollment for non-human actor carried out by Org admin
- Enrollment for human actor carried out by Identity Owner

1. As CA Admin **Registers Identities**
   - To set the `FABRIC_CA_CLIENT_HOME`
     - `. ./setclient.sh <ORG_NAME> <ENROLLMENT_ID>`
   - To create the necessary client folders for an identity
     - `mkdir -p $FABRIC_CA_CLIENT_HOME`
   - Create `acme/admin`, `budget/admin`, `orderer/admin` subfolders in client folder.
   - Copy client YAML files
2. As Org Admin Identity **Enroll**
   - `./register-enroll-admins.sh`
   - `fabric-ca-client identity list` as caserver admin
